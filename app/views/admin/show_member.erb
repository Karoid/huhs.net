<div class="right_col" role="main">
  <div class="col-md-12 col-sm-12 col-xs-12">
    <div class="x_panel">
      <div class="x_title">
        <h2>신규 가입자</h2>
        <ul class="nav navbar-right panel_toolbox">
          <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
          </li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="#">Settings 1</a>
              </li>
              <li><a href="#">Settings 2</a>
              </li>
            </ul>
          </li>
          <li><a class="close-link"><i class="fa fa-close"></i></a>
          </li>
        </ul>
        <div class="clearfix"></div>
      </div>

      <div class="x_content">

        <table id="datatable_nonmember" class="table table-striped responsive-utilities jambo_table dt-responsive nowrap" width="100%">
          <thead>
            <tr class="headings">
              <th>
                <input type="checkbox" id="check-all" class="flat" disabled>
              </th>
              <th class="column-title">기수 </th>
              <th class="column-title">이름 </th>
              <th class="column-title">전공 </th>
              <th class="column-title">이메일 </th>
              <th class="column-title">번호 </th>
              <th class="column-title">회원상태 </th>
              <th class="column-title no-link last"><span class="nobr">Action</span>
              </th>
              <th class="bulk-actions" colspan="7">
                <a class="antoo" style="color:#fff; font-weight:500;">Bulk Actions ( <span class="action-cnt"> </span> ) <i class="fa fa-chevron-down"></i></a>
              </th>
            </tr>
          </thead>

          <tbody>
            <% @nonMember.each do |member|%>
            <tr class="even pointer">
              <td class="a-center " name="id">
                <input type="checkbox" class="flat" name="table_records" id="<%=member.id%>">
              </td>
              <td class=" "><%=member.senior_number%></td>
              <td class=" "><%=member.username%></td>
              <td class=" "><%=member.major.name%></td>
              <td class=" "><%=member.email%></td>
              <td class=" "><%=member.tel%></td>
              <td class=" " name="role"><%=member.role%></td>
              <td class=" last"><a href="#datatable_nonmember" class="edit_nonmember">Edit</a>
              </td>
            </tr>
            <%end%>
          </tbody>
        </table>
      </div>
      <button id="make_nonmember_as_submember" class="btn btn-success">준회원</button>
      <button class="btn btn-success make_as_member">정회원</button>
      <button class="btn btn-success make_as_graduate">졸업생</button>
      <button id="delete_nonmember" class="btn btn-danger">탈퇴</button>
    </div>
  </div>

  <div class="col-md-12 col-sm-12 col-xs-12">
    <div class="x_panel">
      <div class="x_title">
        <h2>기존 회원</h2>
        <ul class="nav navbar-right panel_toolbox">
          <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
          </li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="#">Settings 1</a>
              </li>
              <li><a href="#">Settings 2</a>
              </li>
            </ul>
          </li>
          <li><a class="close-link"><i class="fa fa-close"></i></a>
          </li>
        </ul>
        <div class="clearfix"></div>
      </div>

      <div class="x_content">

        <table id="datatable_member" class="table table-striped responsive-utilities jambo_table dt-responsive nowrap" width="100%">
          <thead>
            <tr class="headings">
              <th>
                <input type="checkbox" id="check-all" class="flat" disabled>
              </th>
              <th class="column-title">기수 </th>
              <th class="column-title">이름 </th>
              <th class="column-title">전공 </th>
              <th class="column-title">이메일 </th>
              <th class="column-title">번호 </th>
              <th class="column-title">회원상태 </th>
              <th class="column-title no-link last"><span class="nobr">Action</span>
              </th>
              <th class="bulk-actions" colspan="7">
                <a class="antoo" style="color:#fff; font-weight:500;">Bulk Actions ( <span class="action-cnt"> </span> ) <i class="fa fa-chevron-down"></i></a>
              </th>
            </tr>
          </thead>

          <tbody>
            <% @member.each do |member|%>
            <tr class="even pointer">
              <td class="a-center " name="id">
                <input type="checkbox" class="flat" name="table_records" id="<%=member.id%>">
              </td>
              <td class=" "><%=member.senior_number%></td>
              <td class=" "><%=member.username%></td>
              <td class=" "><%=member.major.name%></td>
              <td class=" "><%=member.email%></td>
              <td class=" "><%=member.tel%></td>
              <td class=" " name="role"><%=member.role%></td>
              <td class=" last"><a href="#datatable_member" class="edit_member">Edit</a>
              </td>
            </tr>
            <%end%>
          </tbody>
        </table>
      </div>
      <button id="make_member_as_staff" class="btn btn-primary">스태프 임명</button>
      <button class="btn btn-success make_as_member">정회원</button>
      <button class="btn btn-success make_as_graduate">졸업생</button>
      <button id="reset_password" class="btn btn-warning">비번 초기화</button>
      <button id="delete_member" class="btn btn-danger">탈퇴</button>
    </div>
  </div>

  <div class="col-md-6 col-sm-12 col-xs-12">
    <div class="x_panel">
      <div class="x_title">
        <h2>임원, 관리자</h2>
        <ul class="nav navbar-right panel_toolbox">
          <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
          </li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="#">Settings 1</a>
              </li>
              <li><a href="#">Settings 2</a>
              </li>
            </ul>
          </li>
          <li><a class="close-link"><i class="fa fa-close"></i></a>
          </li>
        </ul>
        <div class="clearfix"></div>
      </div>

      <div class="x_content">

        <table id="datatable_staff" class="table table-striped responsive-utilities jambo_table dt-responsive nowrap" width="100%">
          <thead>
            <tr class="headings">
              <th>
                <input type="checkbox" id="check-all" class="flat" disabled>
              </th>
              <th class="column-title">기수 </th>
              <th class="column-title">이름 </th>
              <th class="column-title">임원 </th>
              <th class="column-title">관리자 </th>
              <th class="column-title no-link last"><span class="nobr">Action</span>
              </th>
              <th class="bulk-actions" colspan="7">
                <a class="antoo" style="color:#fff; font-weight:500;">Bulk Actions ( <span class="action-cnt"> </span> ) <i class="fa fa-chevron-down"></i></a>
              </th>
            </tr>
          </thead>

          <tbody>
            <% @staff.each do |member|%>
            <tr class="even pointer">
              <td class="a-center " name="id">
                <input type="checkbox" class="flat" name="table_records" id="<%=member.id%>">
              </td>
              <td class=" "><%=member.senior_number%></td>
              <td class=" "><%=member.username%></td>
              <td class=" " name="staff"><%=member.staff%></td>
              <td class=" " name="admin"><%=member.admin%></td>
              <td class=" last"><a href="#datatable_member" class="edit_staff">Edit</a>
              </td>
            </tr>
            <%end%>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="col-md-6 col-sm-12 col-xs-12">
    <div class="x_panel">
      <div class="x_title">
        <h2>전공 관리</h2>
        <ul class="nav navbar-right panel_toolbox">
          <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
          </li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="#">Settings 1</a>
              </li>
              <li><a href="#">Settings 2</a>
              </li>
            </ul>
          </li>
          <li><a class="close-link"><i class="fa fa-close"></i></a>
          </li>
        </ul>
        <div class="clearfix"></div>
      </div>

      <div class="x_content">

        <table id="datatable_major" class="table table-striped responsive-utilities jambo_table dt-responsive nowrap" width="100%">
          <thead>
            <tr class="headings">
              <th>
                <input type="checkbox" id="check-all" class="flat" disabled>
              </th>
              <th class="column-title">번호 </th>
              <th class="column-title">학과명 </th>
              <th class="column-title">대학명 </th>
              <th class="column-title no-link last"><span class="nobr">Action</span>
              </th>
              <th class="bulk-actions" colspan="7">
                <a class="antoo" style="color:#fff; font-weight:500;">Bulk Actions ( <span class="action-cnt"> </span> ) <i class="fa fa-chevron-down"></i></a>
              </th>
            </tr>
          </thead>

          <tbody>
            <% @major.each do |major|%>
            <tr class="even pointer">
              <td class="a-center " name="id">
                <input type="checkbox" class="flat" name="table_records" id="<%=major.id%>">
              </td>
              <td class=" "><%=major.id%></td>
              <td class=" " name="name"><%=major.name%></td>
              <td class=" " name="department"><%=major.department%></td>
              <td class=" last"><a href="#datatable_major" class="edit_major">Edit</a>
              </td>
            </tr>
            <%end%>
          </tbody>
        </table>
        <button id="delete_major" class="btn btn-danger">삭제</button>
        <button id="create_major" class="btn btn-success">추가</button>
      </div>
    </div>
  </div>

  <script src="/js/admin_table.js"></script>

  <script src="/js/datatables/jquery.dataTables.min.js"></script>
  <script src="/js/datatables/dataTables.bootstrap.js"></script>
  <script src="/js/datatables/dataTables.buttons.min.js"></script>
  <script src="/js/datatables/buttons.bootstrap.min.js"></script>
  <script src="/js/datatables/jszip.min.js"></script>
  <script src="/js/datatables/vfs_fonts.js"></script>
  <script src="/js/datatables/buttons.html5.min.js"></script>
  <script src="/js/datatables/buttons.print.min.js"></script>
  <script src="/js/datatables/dataTables.fixedHeader.min.js"></script>
  <script src="/js/datatables/dataTables.keyTable.min.js"></script>
  <script src="/js/datatables/dataTables.responsive.min.js"></script>
  <script src="/js/datatables/responsive.bootstrap.min.js"></script>
  <script src="/js/datatables/dataTables.scroller.min.js"></script>
  <style>
  table th {
    cursor: pointer;
  }
  table[role=grid]{
    margin:0;
  }
  </style>
  <script type="text/javascript">
  $(document).ready(function() {
    var dt_nonmember = $('#datatable_nonmember').DataTable({
        scrollY:        '50vh',
        scrollCollapse: true,
        paging:         false
    });
    var dt_member = $('#datatable_member').DataTable({
        scrollY:        '50vh',
        scrollCollapse: true,
        paging:         false,
        'responsive': {
        'details': {
           'type': 'column',
           'target': 5
        }
      }
    });
    var dt_major = $('#datatable_major').DataTable({
        scrollY:        '50vh',
        scrollCollapse: true,
        paging:         false,
        'responsive': {
        'details': {
           'type': 'column',
           'target': 5
        }
      }
    });
    function change_member_state(role_num,thisButton){
      if($(thisButton).parent().children("div.x_content").children("div#datatable_nonmember_wrapper")[0]){
        var thisClass = nonMemberTable
      }else{
        var thisClass = memberTable
      }
      $(thisClass.tableElement).find(".flat").each(function(index, el) {
    		if (el.checked) {
          thisClass.edit_ajax({data: {id: el.id, role: role_num}, db: thisClass.dbname},function(data){})
    		}
    	});
      return window.location.reload()
    }
    var nonMemberTable = new Admin_table('#datatable_nonmember',"Member")
    $("#delete_nonmember").click(function(event) {
      /* Act on the event */
      nonMemberTable.delete(".flat");
    });
    $("#make_nonmember_as_submember").click(function(){change_member_state(1,this)});
    $(".make_as_member").click(function(){change_member_state(2,this)});
    $(".make_as_graduate").click(function(){change_member_state(3,this)});
    nonMemberTable.edit(".edit_nonmember")
    var memberTable = new Admin_table('#datatable_member',"Member")
    $("#delete_member").click(function(event) {
      /* Act on the event */
      memberTable.delete(".flat");
    });
    memberTable.edit(".edit_member")
    $("#make_member_as_staff").click(function(event) {
      memberTable.destroy(".flat",'/admin/active_staff')
    });
    $("#reset_password").click(function(){
      var thisClass = memberTable
      $(thisClass.tableElement).find(".flat").each(function(index, el) {
    		if (el.checked) {
          thisClass.edit_ajax({data: {id: el.id, encrypted_password: "$2a$11$RuiZ90W7n3LqR4uytQ2eLOJ7nKgsFCAXaej9WyEi3qSyFa.dBJehu"}, db: thisClass.dbname},function(data){alert("성공")})
    		}
    	});
      return window.location.reload()
    });
    var staffTable = new Admin_table('#datatable_staff',"Member")
    staffTable.edit(".edit_staff")
    var majorTable = new Admin_table('#datatable_major',"Major")
    majorTable.edit(".edit_major")
    majorTable.create("#create_major");
    $("#delete_major").click(function(event) {
      /* Act on the event */
      majorTable.delete(".flat");
    });
  });
  </script>
  <link rel="stylesheet" href="/css/admin_table.css">
</div>
